<style>
.select2-container--bootstrap-5 .select2-selection{background-color:var(--bs-body-bg)!important;border:1px solid var(--bs-body-color)!important;border-radius:4px;min-height:31px}.select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered{color:var(--bs-body-color)!important;line-height:28px;padding-left:12px}.select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered span,.select2-container--bootstrap-5 .select2-selection__clear{color:var(--bs-body-color)!important}.select2-container--bootstrap-5 .select2-selection__arrow b{border-color:var(--bs-body-color) transparent transparent transparent!important}.select2-container--bootstrap-5.select2-container--focus .select2-selection,.select2-container--bootstrap-5.select2-container--open .select2-selection{border-color:var(--bs-body-color)!important;outline:0;box-shadow:none!important}.select2-container--bootstrap-5 .select2-dropdown{background-color:var(--bs-body-bg)!important;border:2px solid var(--bs-body-color)!important;border-radius:4px}.select2-container--bootstrap-5 .select2-results__options{background-color:var(--bs-body-bg)!important}.select2-container--bootstrap-5 .select2-results__option{background-color:var(--bs-body-bg)!important;color:var(--bs-body-color)!important;padding:10px 12px;border-bottom:1px solid var(--bs-border-color)}.select2-container--bootstrap-5 .select2-results__option:last-child{border-bottom:none}.select2-container--bootstrap-5 .select2-results__option--highlighted{background-color:var(--bs-secondary-bg)!important;color:var(--bs-body-bg)!important}.select2-container--bootstrap-5 .select2-results__option--selected,.select2-container--bootstrap-5 .select2-results__option[aria-selected=true]{background-color:var(--bs-tertiary-bg)!important;color:var(--bs-body-color)!important}.select2-container--bootstrap-5 .select2-search--dropdown .select2-search__field{background-color:var(--bs-body-bg)!important;border:1px solid var(--bs-body-color)!important;color:var(--bs-body-color)!important}.dark .select2-container--bootstrap-5 .select2-selection,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-selection,body.dark-theme .select2-container--bootstrap-5 .select2-selection{background-color:var(--bs-body-bg)!important;border:2px solid var(--bs-body-color)!important}.dark .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered,.dark .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered span,.dark .select2-container--bootstrap-5 .select2-selection__clear,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered span,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-selection__clear,body.dark-theme .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered,body.dark-theme .select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered span,body.dark-theme .select2-container--bootstrap-5 .select2-selection__clear{color:var(--bs-card-title-color)!important}.dark .select2-container--bootstrap-5 .select2-selection__arrow b,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-selection__arrow b,body.dark-theme .select2-container--bootstrap-5 .select2-selection__arrow b{border-color:var(--bs-card-title-color) transparent transparent transparent!important}.dark .select2-container--bootstrap-5.select2-container--focus .select2-selection,.dark .select2-container--bootstrap-5.select2-container--open .select2-selection,[data-bs-theme=dark] .select2-container--bootstrap-5.select2-container--focus .select2-selection,[data-bs-theme=dark] .select2-container--bootstrap-5.select2-container--open .select2-selection,body.dark-theme .select2-container--bootstrap-5.select2-container--focus .select2-selection,body.dark-theme .select2-container--bootstrap-5.select2-container--open .select2-selection{border-color:var(--bs-card-title-color)!important;outline:0;box-shadow:none!important}.dark .select2-container--bootstrap-5 .select2-dropdown,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-dropdown,body.dark-theme .select2-container--bootstrap-5 .select2-dropdown{background-color:var(--bs-body-bg)!important;border:2px solid var(--bs-card-title-color)!important}.dark .select2-container--bootstrap-5 .select2-results__options,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-results__options,body.dark-theme .select2-container--bootstrap-5 .select2-results__options{background-color:var(--bs-body-bg)!important}.dark .select2-container--bootstrap-5 .select2-results__option,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-results__option,body.dark-theme .select2-container--bootstrap-5 .select2-results__option{background-color:var(--bs-body-bg)!important;color:var(--bs-card-title-color)!important;border-bottom:1px solid var(--bs-border-color)}.dark .select2-container--bootstrap-5 .select2-results__option:last-child,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-results__option:last-child,body.dark-theme .select2-container--bootstrap-5 .select2-results__option:last-child{border-bottom:none}.dark .select2-container--bootstrap-5 .select2-results__option--highlighted,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-results__option--highlighted,body.dark-theme .select2-container--bootstrap-5 .select2-results__option--highlighted{background-color:var(--bs-secondary-bg)!important;color:var(--bs-body-bg)!important}.dark .select2-container--bootstrap-5 .select2-results__option--selected,.dark .select2-container--bootstrap-5 .select2-results__option[aria-selected=true],[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-results__option--selected,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-results__option[aria-selected=true],body.dark-theme .select2-container--bootstrap-5 .select2-results__option--selected,body.dark-theme .select2-container--bootstrap-5 .select2-results__option[aria-selected=true]{background-color:var(--bs-tertiary-bg)!important;color:var(--bs-card-title-color)!important}.dark .select2-container--bootstrap-5 .select2-search--dropdown .select2-search__field,[data-bs-theme=dark] .select2-container--bootstrap-5 .select2-search--dropdown .select2-search__field,body.dark-theme .select2-container--bootstrap-5 .select2-search--dropdown .select2-search__field{background-color:var(--bs-body-bg)!important;border:1px solid var(--bs-card-title-color)!important;color:var(--bs-card-title-color)!important}
.select2-container--bootstrap-5 .select2-results__options {
    max-height: 260px;        /* adjust height as needed */
    overflow-y: auto;
}
.select2-container--bootstrap-5 .select2-results__options {
    scrollbar-width: thin; /* Firefox */
}

.select2-container--bootstrap-5 .select2-results__options::-webkit-scrollbar {
    width: 6px;
}
.select2-container--bootstrap-5 .select2-results__options::-webkit-scrollbar-thumb {
    background-color: var(--bs-border-color);
    border-radius: 4px;
}
</style>
<script>
        function formatOption(option) {
            if (!option.id) {
                return $(`<span>${option.text}</span>`);
            }

            let image = $(option.element).data('image');

            if (image) {
                return $(`
                    <div class="d-flex align-items-center gap-3">
                        <img
                            src="${image}"
                            class="rounded-circle border"
                            width="38"
                            height="38"
                            style="object-fit:cover"
                        >
                        <div class="d-flex flex-column">
                            <span class="fw-semibold">${option.text}</span>
                        </div>
                    </div>
                `);
            }

            let content = $(option.element).data('content');

            if(content){
                // Create container div
                const $container = $('<div class="d-flex align-items-center gap-3"></div>');

                // Create and append content wrapper with HTML content
                const $contentWrapper = $('<div class="content-wrapper"></div>').html(content);
                $container.append($contentWrapper);

                // Create and append text wrapper
                const $textWrapper = $('<div class="d-flex flex-column"></div>');
                const $textSpan = $('<span class="fw-semibold"></span>').text(option.text);
                $textWrapper.append($textSpan);
                $container.append($textWrapper);

                return $container;
            }

            return $(`
                <div class="fw-medium">
                    ${option.text}
                </div>
            `);
        }

       let select2Timeout = null;

        function renderSelect2() {

            $('.select2').each(function () {
                if ($(this).hasClass("select2-hidden-accessible")) {
                    $(this).select2('destroy');
                }
            });

            $(".select2").each(function() {
                let $parentModal = $(this).closest('.modal');
                let options = {
                    theme: 'bootstrap-5',
                    templateResult: formatOption,
                    templateSelection: formatOption,
                    dropdownAutoWidth: true,
                    width: '100%'
                };
                if ($parentModal.length) {
                    options.dropdownParent = $parentModal;
                }
                $(this).select2(options);
            });

            $('.select2').off('select2:select select2:unselect').on(
                'select2:select select2:unselect',
                function (e) {
                    const elem = $(e.currentTarget);
                    @this.set(elem.attr('name'), elem.val());
                }
            );
        }

        document.addEventListener('livewire:initialized', () => {
            renderSelect2();

            Livewire.hook('morph.updated', () => {
                clearTimeout(select2Timeout);
                select2Timeout = setTimeout(() => {
                    renderSelect2();
                }, 150);
            });
        });

</script>
